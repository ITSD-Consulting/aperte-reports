<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="RaportZuzyciaLimitowZadan" language="groovy" pageWidth="595" pageHeight="1842" whenNoDataType="AllSectionsNoDetail" columnWidth="535"
              leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="0" isIgnorePagination="true">
    <property name="ireport.zoom" value="1.0000000000000004"/>
    <property name="ireport.x" value="0"/>
    <property name="ireport.y" value="0"/>
    <property name="net.sf.jasperreports.export.xls.remove.empty.space.between.rows" value="true"/>
    <property name="net.sf.jasperreports.export.xls.remove.empty.space.between.columns" value="true"/>
    <property name="net.sf.jasperreports.export.xls.size.fix.enabled" value="true"/>
    <property name="net.sf.jasperreports.print.keep.full.text" value="true"/>
    <property name="net.sf.jasperreports.export.xls.detect.cell.type" value="true"/>
    <property name="net.sf.jasperreports.chart.theme" value="aegean"/>
    <style name="Detail" hAlign="Left" vAlign="Middle" fontSize="10" pdfEncoding="Cp1250">
        <box topPadding="3" leftPadding="3" bottomPadding="3" rightPadding="3">
            <topPen lineWidth="0.25" lineColor="#999999"/>
            <leftPen lineWidth="0.25" lineColor="#999999"/>
            <bottomPen lineWidth="0.25" lineColor="#999999"/>
            <rightPen lineWidth="0.25" lineColor="#999999"/>
        </box>
    </style>
    <style name="Title" fontSize="16" isBold="true" pdfEncoding="Cp1250"/>
    <style name="SubTitle" forecolor="#666666" fontSize="10" pdfEncoding="Cp1250">
        <box topPadding="3" leftPadding="3" bottomPadding="3" rightPadding="3"/>
    </style>
    <style name="Column header" forecolor="#FFFFFF" backcolor="#000000" fill="Solid" hAlign="Center" vAlign="Middle" fontSize="10" isBold="true"
           pdfEncoding="Cp1250">
        <box topPadding="3" leftPadding="3" bottomPadding="3" rightPadding="3">
            <topPen lineWidth="0.5" lineColor="#000000"/>
            <leftPen lineWidth="0.5" lineColor="#000000"/>
            <bottomPen lineWidth="0.5" lineColor="#000000"/>
            <rightPen lineWidth="0.5" lineColor="#000000"/>
        </box>
    </style>
    <style name="Group" style="Detail" hAlign="Left" vAlign="Middle" markup="none" fontSize="10" isBold="true" pdfEncoding="Cp1250"/>
    <subDataset name="projects_dataset">
        <parameter name="projects" class="java.lang.String"/>
        <parameter name="login" class="java.lang.String"/>
        <queryString language="SQL">
            <![CDATA[SELECT name,
                    CASE SUM(level)
                        WHEN 2 THEN 'PM1'
                        WHEN 4 THEN 'PM2'
                        WHEN 6 THEN 'PM1, PM2'
                    END AS level
                FROM blues_tree_nodes btn LEFT JOIN blues_projects_users bpu ON btn.id = bpu.project_id
                WHERE btn.id IN ($P!{projects})
                    AND bpu.user_id = (SELECT id FROM blues_users WHERE ldapdn LIKE '%$P!{login}%')
                    AND bpu.level IN (2,4)
                GROUP BY btn.id, btn.name
                ORDER BY name]]>
        </queryString>
        <field name="name" class="java.lang.String"/>
        <field name="level" class="java.lang.String"/>
    </subDataset>
    <subDataset name="chart_dataset">
        <parameter name="projects" class="java.lang.String"/>
        <parameter name="login" class="java.lang.String"/>
        <parameter name="limit_used" class="java.lang.String"/>
        <queryString language="SQL">
            <![CDATA[SELECT
                    project_name,
                    phase_name,
                    task_name,
                    task_id,
                    tasklimit,
                    CASE orderlimit > 0
                        WHEN true THEN orderlimit
                        ELSE 0
                    END AS orderlimit,
                    CASE taskreserve > 0
                        WHEN true THEN taskreserve
                        ELSE 0
                    END AS taskreserve,
                    reportedhrssum,
                    (tasklimit - reportedhrssum) AS limitleft,
                        CASE
                            WHEN (taskreserve <= 0 OR taskreserve IS NULL) THEN 0
                            WHEN reportedhrssum > tasklimit THEN (taskreserve + tasklimit - reportedhrssum)
                            ELSE taskreserve
                        END as reserveleft
                FROM (
                    SELECT
                        bt.treenode_id AS task_id,
                        project.id AS project_id,
                        project.name AS project_name,
                        phase.name AS phase_name,
                        task.name AS task_name,
                        bt.orderlimit AS orderlimit,

                        SUM(
                            CASE reportedhrs != 'NaN'
                            WHEN true THEN reportedhrs
                            ELSE 0
                            END)
                          +
                        SUM(
                            CASE reportedoverhrs != 'NaN'
                            WHEN true THEN reportedoverhrs
                            ELSE 0
                            END) as reportedhrssum,
                        tasklimit,
                        taskreserve
                    FROM blues_tasks bt
                        LEFT OUTER JOIN blues_timesheet_entry bte ON bt.treenode_id = bte.task_id
                        LEFT JOIN blues_tree_nodes task ON bt.treenode_id = task.id
                        LEFT JOIN blues_tree_nodes phase ON task.parent_id = phase.id
                        LEFT JOIN blues_tree_nodes project ON bt.project_id = project.id
                    WHERE tasklimit > 0
                        AND project.id IN ($P!{projects})
                        AND bte.status IN ('MA', 'S', 'WA')
                    GROUP BY bt.project_id, bt.treenode_id, bt.tasklimit, bt.taskreserve, project.name, phase.name, task.name, project.id, orderlimit
                    ) AS data

                WHERE reportedhrssum/tasklimit * 100 >= $P!{limit_used}
                    AND EXISTS(SELECT 1 FROM blues_projects_users bpu JOIN blues_users bu ON bpu.user_id=bu.id WHERE bpu.project_id = data.project_id AND bu.ldapdn LIKE '%$P!{login}%' AND bpu.level IN (2,4))
                ORDER BY reportedhrssum/tasklimit DESC]]>
        </queryString>
        <field name="project_name" class="java.lang.String"/>
        <field name="phase_name" class="java.lang.String"/>
        <field name="task_name" class="java.lang.String"/>
        <field name="task_id" class="java.lang.Integer"/>
        <field name="orderlimit" class="java.lang.Integer"/>
        <field name="reportedhrssum" class="java.lang.Float"/>
        <field name="tasklimit" class="java.lang.Long"/>
        <field name="taskreserve" class="java.lang.Long"/>
        <field name="limitleft" class="java.lang.Double"/>
        <field name="reserveleft" class="java.lang.Double"/>
    </subDataset>
    <parameter name="login" class="java.lang.String">
        <defaultValueExpression><![CDATA["nonexistant user"]]></defaultValueExpression>
    </parameter>
    <parameter name="options" class="java.lang.String">
        <property name="input_type" value="CHECKBOXES"/>
        <property name="label" value="Opcje"/>
        <property name="dict_item_list"
                  value="chart:pokaż wykres;table:pokaż tabelę;projects:pokaż listę analizowanych projektów;details:pokaż pracowników w zadaniach"/>
        <defaultValueExpression><![CDATA["'chart','table','projects','details'"]]></defaultValueExpression>
    </parameter>
    <parameter name="limit_used" class="java.lang.String">
        <property name="input_type" value="text"/>
        <property name="label" value="próg zużycia limit (w %)"/>
        <property name="regexp" value="[0-9]{1,2}"/>
        <property name="required" value="true"/>
        <property name="required_error" value="minimalny próg jest wymagany"/>
    </parameter>
    <parameter name="project_folder" class="java.lang.String">
        <property name="level" value="2"/>
        <property name="input_type" value="filter"/>
        <property name="label" value="filtruj folder"/>
        <property name="filter_group" value="projects_group"/>
    </parameter>
    <parameter name="project_status" class="java.lang.String">
        <property name="level" value="1"/>
        <property name="input_type" value="filter"/>
        <property name="label" value="filtruj status"/>
        <property name="filter_group" value="projects_group"/>
    </parameter>
    <parameter name="projects" class="java.lang.String">
        <property name="level" value="0"/>
        <property name="input_type" value="filtered_select"/>
        <property name="label" value="nazwa projektu"/>
        <property name="filter_group" value="projects_group"/>
        <property name="select_all" value="true"/>
        <property name="dict_query"
                  value="java:comp/env/jdbc/nblues;                 SELECT DISTINCT treenode_id, project.name, status, catalog.name                 FROM blues_projects                      LEFT JOIN blues_tree_nodes project ON treenode_id=project.id                      LEFT JOIN blues_projects_users ON project_id=treenode_id                      LEFT JOIN blues_users bu ON bu.id=user_id                     LEFT JOIN blues_tree_nodes catalog ON project.parent_id=catalog.id                 WHERE ldapdn LIKE &apos;%$LOGIN%&apos; AND level IN(2,4)"/>
        <property name="multiple_choice" value="true"/>
        <defaultValueExpression><![CDATA["SELECT treenode_id FROM blues_projects"]]></defaultValueExpression>
    </parameter>
    <parameter name="datasource" class="java.lang.String">
        <parameterDescription><![CDATA[java:comp/env/jdbc/nblues]]></parameterDescription>
        <defaultValueExpression><![CDATA["java:comp/env/jdbc/nblues"]]></defaultValueExpression>
    </parameter>
    <queryString>
        <![CDATA[SELECT
                project_name,
                phase_name,
                task_name,
                CASE fullnamecached IS NULL
                    WHEN true THEN substring(ldapdn from 'uid=([^,]+),')
                    ELSE fullnamecached
                END as login,
                users_sum.total AS total,
                users.reportedhrssum AS taskuserhrs,
                CASE budgetwrh > 0
                    WHEN true THEN budgetwrh
                    ELSE NULL
                END AS taskuserlimit,
                CASE budgetwrh > 0
                    WHEN true THEN budgetwrh - users.reportedhrssum
                    ELSE NULL
                END AS taskuserlimitleft,
                tasks.reportedhrssum AS taskhrs,
                tasklimit,
                CASE orderlimit > 0
                    WHEN true THEN orderlimit
                    ELSE NULL
                END AS orderlimit,
                CASE taskreserve > 0
                    WHEN true THEN taskreserve
                    ELSE NULL
                END AS taskreserve,
                (tasklimit - tasks.reportedhrssum) AS tasklimitleft,
                    CASE
                        WHEN (taskreserve <= 0 OR taskreserve IS NULL) THEN NULL
                        WHEN tasks.reportedhrssum > tasklimit THEN (taskreserve + tasklimit - tasks.reportedhrssum)
                        ELSE taskreserve
                    END as taskreserveleft
            FROM (
                SELECT
                    bt.treenode_id AS task_id,
                    project.id AS project_id,
                    project.name AS project_name,
                    phase.name AS phase_name,
                    task.name AS task_name,
                    bt.orderlimit AS orderlimit,

                    SUM(
                        CASE reportedhrs != 'NaN'
                        WHEN true THEN reportedhrs
                        ELSE 0
                        END)
                      +
                    SUM(
                        CASE reportedoverhrs != 'NaN'
                        WHEN true THEN reportedoverhrs
                        ELSE 0
                        END) as reportedhrssum,
                    tasklimit,
                    taskreserve
                FROM blues_tasks bt
                    LEFT OUTER JOIN blues_timesheet_entry bte ON bt.treenode_id = bte.task_id
                    LEFT JOIN blues_tree_nodes task ON bt.treenode_id = task.id
                    LEFT JOIN blues_tree_nodes phase ON task.parent_id = phase.id
                    LEFT JOIN blues_tree_nodes project ON bt.project_id = project.id
                WHERE tasklimit > 0
                    AND project.id IN ($P!{projects})
                    AND bte.status IN ('MA', 'S', 'WA')
                GROUP BY bt.project_id, bt.treenode_id, bt.tasklimit, bt.taskreserve, project.name, phase.name, task.name, project.id, orderlimit
                ) AS tasks
                LEFT JOIN
                    (SELECT
                        bt.treenode_id AS task_id,
                        bte.user_id AS user_id,
                        ldapdn,
                        fullnamecached,

                        SUM(
                            CASE reportedhrs != 'NaN'
                            WHEN true THEN reportedhrs
                            ELSE 0
                            END)
                          +
                        SUM(
                            CASE reportedoverhrs != 'NaN'
                            WHEN true THEN reportedoverhrs
                            ELSE 0
                            END) as reportedhrssum
                    FROM blues_tasks bt
                        LEFT OUTER JOIN blues_timesheet_entry bte ON bt.treenode_id = bte.task_id
                        LEFT JOIN blues_users bu ON bte.user_id = bu.id
                    WHERE bte.status IN ('MA', 'S', 'WA')
                    GROUP BY bt.treenode_id, bte.user_id, ldapdn, fullnamecached
                    ) AS users
                ON tasks.task_id = users.task_id
                LEFT OUTER JOIN
                    (SELECT
                        bt.treenode_id AS task_id,
                        COUNT(distinct bu.id) AS total
                    FROM blues_tasks bt
                        LEFT OUTER JOIN blues_timesheet_entry bte ON bt.treenode_id = bte.task_id
                        LEFT JOIN blues_users bu ON bte.user_id = bu.id
                    WHERE bte.status IN ('MA', 'S', 'WA')
                    GROUP BY bt.treenode_id
                    ) AS users_sum
                ON tasks.task_id = users_sum.task_id
                LEFT JOIN blues_tasks_users btu ON btu.user_id = users.user_id AND btu.task_id = users.task_id


            WHERE tasks.reportedhrssum/tasklimit * 100 >= $P!{limit_used}
                AND EXISTS(SELECT 1 FROM blues_projects_users bpu JOIN blues_users bu ON bpu.user_id=bu.id WHERE bpu.project_id = tasks.project_id AND bu.ldapdn LIKE '%$P!{login}%' AND bpu.level IN (2,4))
            ORDER BY project_name, phase_name, task_name, tasks.reportedhrssum/tasklimit DESC]]>
    </queryString>
    <field name="project_name" class="java.lang.String"/>
    <field name="phase_name" class="java.lang.String"/>
    <field name="task_name" class="java.lang.String"/>
    <field name="login" class="java.lang.String"/>
    <field name="total" class="java.lang.Integer"/>
    <field name="orderlimit" class="java.lang.Integer"/>
    <field name="taskuserhrs" class="java.lang.Float"/>
    <field name="taskuserlimit" class="java.lang.Float"/>
    <field name="taskuserlimitleft" class="java.lang.Float"/>
    <field name="taskhrs" class="java.lang.Float"/>
    <field name="tasklimit" class="java.lang.Float"/>
    <field name="taskreserve" class="java.lang.Float"/>
    <field name="tasklimitleft" class="java.lang.Float"/>
    <field name="taskreserveleft" class="java.lang.Float"/>
    <variable name="taskChanged" class="java.lang.Integer" resetType="Group" resetGroup="TaskGroup" calculation="Count">
        <variableExpression><![CDATA[$V{taskChanged}]]></variableExpression>
    </variable>
    <variable name="taskName" class="java.lang.String">
        <variableExpression>
            <![CDATA[$V{taskChanged} == 0 ? $V{taskName} + "<a href=\"google.com/search?q=" + $F{task_name} + "\">" + $F{task_name} + "</a><BR/>" : $V{taskName}]]></variableExpression>
        <initialValueExpression><![CDATA[new java.lang.String()]]></initialValueExpression>
    </variable>
    <group name="ProjectGroup" isReprintHeaderOnEachPage="true">
        <groupExpression><![CDATA[$F{project_name}]]></groupExpression>
        <groupHeader>
            <band height="20">
                <printWhenExpression><![CDATA[$P{options}.contains("table") && false]]></printWhenExpression>
                <frame>
                    <reportElement mode="Opaque" x="0" y="0" width="555" height="20" backcolor="#CCFFFF"/>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" x="0" y="0" width="55" height="20" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                        <textElement textAlignment="Left">
                            <font isBold="true"/>
                        </textElement>
                        <textFieldExpression class="java.lang.String"><![CDATA[$F{project_name}]]></textFieldExpression>
                    </textField>
                </frame>
            </band>
        </groupHeader>
    </group>
    <group name="PhaseGroup" isReprintHeaderOnEachPage="true">
        <groupExpression><![CDATA[$F{phase_name}]]></groupExpression>
        <groupHeader>
            <band height="20">
                <printWhenExpression><![CDATA[$P{options}.contains("table") && false]]></printWhenExpression>
                <frame>
                    <reportElement mode="Opaque" x="0" y="0" width="555" height="20" backcolor="#FFCCFF"/>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" x="55" y="0" width="66" height="20" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                        <textElement textAlignment="Left">
                            <font isBold="true"/>
                        </textElement>
                        <textFieldExpression class="java.lang.String"><![CDATA[$F{phase_name}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" x="0" y="0" width="55" height="20" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                        <textElement textAlignment="Left">
                            <font isBold="true"/>
                        </textElement>
                        <textFieldExpression class="java.lang.String"><![CDATA[$F{project_name}]]></textFieldExpression>
                    </textField>
                </frame>
            </band>
        </groupHeader>
    </group>
    <group name="TaskGroup" isReprintHeaderOnEachPage="true">
        <groupExpression><![CDATA[$F{task_name}]]></groupExpression>
        <groupHeader>
            <band height="20">
                <printWhenExpression><![CDATA[$P{options}.contains("table")]]></printWhenExpression>
                <frame>
                    <reportElement mode="Opaque" x="0" y="0" width="555" height="20" backcolor="#FFFFCC"/>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" x="121" y="0" width="66" height="20" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                        <textElement textAlignment="Left">
                            <font isBold="true"/>
                        </textElement>
                        <textFieldExpression class="java.lang.String"><![CDATA[$F{task_name}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" mode="Transparent" x="240" y="0" width="40" height="20"/>
                        <textElement textAlignment="Left"/>
                        <textFieldExpression class="java.lang.Float"><![CDATA[$F{tasklimit}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" mode="Transparent" x="280" y="0" width="52" height="20"/>
                        <textElement textAlignment="Left"/>
                        <textFieldExpression class="java.lang.Float"><![CDATA[$F{taskreserve}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" mode="Transparent" x="332" y="0" width="51" height="20"/>
                        <textElement textAlignment="Left"/>
                        <textFieldExpression class="java.lang.Float"><![CDATA[$F{orderlimit}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" mode="Transparent" x="383" y="0" width="53" height="20"/>
                        <textElement textAlignment="Left"/>
                        <textFieldExpression class="java.lang.Float"><![CDATA[$F{taskhrs}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" mode="Transparent" x="436" y="0" width="39" height="20"/>
                        <textElement textAlignment="Left"/>
                        <textFieldExpression class="java.lang.Float"><![CDATA[$F{tasklimitleft}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" mode="Transparent" x="475" y="0" width="40" height="20"/>
                        <textElement textAlignment="Left"/>
                        <textFieldExpression class="java.lang.Float"><![CDATA[$F{taskreserveleft}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" mode="Transparent" x="515" y="0" width="40" height="20"/>
                        <textElement textAlignment="Left"/>
                        <textFieldExpression class="java.lang.Float">
                            <![CDATA[($F{tasklimitleft} > 0 ? $F{tasklimitleft} : 0) + ($F{taskreserveleft} != null ? $F{taskreserveleft} : 0)]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" x="55" y="0" width="66" height="20" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                        <textElement textAlignment="Left">
                            <font isBold="true"/>
                        </textElement>
                        <textFieldExpression class="java.lang.String"><![CDATA[$F{phase_name}]]></textFieldExpression>
                    </textField>
                    <textField isBlankWhenNull="true">
                        <reportElement style="Group" x="0" y="0" width="55" height="20" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                        <textElement textAlignment="Left">
                            <font isBold="true"/>
                        </textElement>
                        <textFieldExpression class="java.lang.String"><![CDATA[$F{project_name}]]></textFieldExpression>
                    </textField>
                    <textField>
                        <reportElement style="Detail" x="187" y="1" width="53" height="19"/>
                        <textElement/>
                        <textFieldExpression class="java.lang.Integer"><![CDATA[$F{total}]]></textFieldExpression>
                    </textField>
                </frame>
            </band>
        </groupHeader>
    </group>
    <background>
        <band splitType="Stretch"/>
    </background>
    <title>
        <band height="174" splitType="Stretch">
            <textField>
                <reportElement style="Title" x="0" y="0" width="555" height="59"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression class="java.lang.String"><![CDATA["R004 – Pracochłonność zadań w MD w projektach"]]></textFieldExpression>
            </textField>
            <textField evaluationTime="Report">
                <reportElement style="SubTitle" x="121" y="59" width="159" height="26"/>
                <textElement textAlignment="Left" verticalAlignment="Middle"/>
                <textFieldExpression class="java.util.Date"><![CDATA[new java.util.Date()]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement style="SubTitle" x="0" y="85" width="121" height="26"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[Minimum zużycia limitu:]]></text>
            </staticText>
            <textField evaluationTime="Report">
                <reportElement style="SubTitle" x="121" y="85" width="159" height="26"/>
                <textElement textAlignment="Left" verticalAlignment="Middle"/>
                <textFieldExpression class="java.lang.String"><![CDATA[$P{limit_used} + "%"]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement style="SubTitle" x="0" y="111" width="121" height="26"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[Twórca:]]></text>
            </staticText>
            <textField evaluationTime="Report">
                <reportElement style="SubTitle" x="121" y="111" width="159" height="26"/>
                <textElement textAlignment="Left" verticalAlignment="Middle"/>
                <textFieldExpression class="java.lang.String"><![CDATA[$P{login}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement style="SubTitle" x="0" y="59" width="121" height="26"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[Data wygenerowania:]]></text>
            </staticText>
        </band>
    </title>
    <pageHeader>
        <band splitType="Stretch"/>
    </pageHeader>
    <columnHeader>
        <band height="40" splitType="Stretch">
            <printWhenExpression><![CDATA[$P{options}.contains("table")]]></printWhenExpression>
            <frame>
                <reportElement mode="Opaque" x="0" y="0" width="555" height="40" backcolor="#666666"/>
                <staticText>
                    <reportElement style="Column header" mode="Transparent" x="0" y="0" width="55" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[projekt]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="187" y="0" width="53" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[login]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="240" y="0" width="40" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[limit]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="280" y="0" width="52" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[rezerwa]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="332" y="0" width="51" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[h zamów]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="383" y="0" width="53" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[zuzyte godziny]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="436" y="0" width="119" height="20" backcolor="#525252"/>
                    <textElement textAlignment="Center"/>
                    <text><![CDATA[pozostalo]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="436" y="20" width="39" height="20" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[limit]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="475" y="20" width="40" height="20" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[rezerwa]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" x="515" y="20" width="40" height="20" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[razem]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" mode="Transparent" x="55" y="0" width="66" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[faza]]></text>
                </staticText>
                <staticText>
                    <reportElement style="Column header" mode="Transparent" x="121" y="0" width="66" height="40" backcolor="#525252"/>
                    <textElement textAlignment="Left"/>
                    <text><![CDATA[zadanie]]></text>
                </staticText>
            </frame>
        </band>
    </columnHeader>
    <detail>
        <band height="19" splitType="Stretch">
            <printWhenExpression>
                <![CDATA[$P{options}.contains("table") && $P{options}.contains("details") && $V{ProjectGroup_COUNT} > 0]]></printWhenExpression>
            <frame>
                <reportElement x="0" y="0" width="555" height="19"/>
                <textField>
                    <reportElement style="Detail" x="187" y="0" width="53" height="19"/>
                    <textElement/>
                    <textFieldExpression class="java.lang.String"><![CDATA[$F{login}]]></textFieldExpression>
                </textField>
                <textField isBlankWhenNull="true">
                    <reportElement style="Detail" x="240" y="0" width="40" height="19"/>
                    <textElement/>
                    <textFieldExpression class="java.lang.Float"><![CDATA[$F{taskuserlimit}]]></textFieldExpression>
                </textField>
                <textField>
                    <reportElement style="Detail" x="383" y="0" width="53" height="19"/>
                    <textElement/>
                    <textFieldExpression class="java.lang.Float"><![CDATA[$F{taskuserhrs}]]></textFieldExpression>
                </textField>
                <textField isBlankWhenNull="true">
                    <reportElement style="Detail" x="436" y="0" width="39" height="19"/>
                    <textElement/>
                    <textFieldExpression class="java.lang.Float"><![CDATA[$F{taskuserlimitleft}]]></textFieldExpression>
                </textField>
                <textField isBlankWhenNull="true">
                    <reportElement style="Detail" x="0" y="0" width="55" height="19" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                    <textElement textAlignment="Left">
                        <font isBold="true"/>
                    </textElement>
                    <textFieldExpression class="java.lang.String"><![CDATA[$F{project_name}]]></textFieldExpression>
                </textField>
                <textField isBlankWhenNull="true">
                    <reportElement style="Detail" x="55" y="0" width="66" height="19" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                    <textElement textAlignment="Left">
                        <font isBold="true"/>
                    </textElement>
                    <textFieldExpression class="java.lang.String"><![CDATA[$F{phase_name}]]></textFieldExpression>
                </textField>
                <textField isBlankWhenNull="true">
                    <reportElement style="Detail" x="121" y="0" width="66" height="19" isRemoveLineWhenBlank="true" backcolor="#FFFFFF"/>
                    <textElement textAlignment="Left">
                        <font isBold="true"/>
                    </textElement>
                    <textFieldExpression class="java.lang.String"><![CDATA[$F{task_name}]]></textFieldExpression>
                </textField>
            </frame>
        </band>
    </detail>
    <columnFooter>
        <band splitType="Stretch"/>
    </columnFooter>
    <pageFooter>
        <band splitType="Stretch"/>
    </pageFooter>
    <summary>
        <band height="550">
            <stackedBar3DChart>
                <chart renderType="draw" theme="aegean">
                    <reportElement positionType="Float" x="0" y="28" width="555" height="333">
                        <printWhenExpression><![CDATA[$P{options}.contains("chart") && $V{ProjectGroup_COUNT} > 0]]></printWhenExpression>
                    </reportElement>
                    <chartTitle/>
                    <chartSubtitle/>
                    <chartLegend>
                        <font size="8"/>
                    </chartLegend>
                </chart>
                <categoryDataset>
                    <dataset>
                        <datasetRun subDataset="chart_dataset">
                            <datasetParameter name="login">
                                <datasetParameterExpression><![CDATA[$P{login}]]></datasetParameterExpression>
                            </datasetParameter>
                            <datasetParameter name="projects">
                                <datasetParameterExpression><![CDATA[$P{projects}]]></datasetParameterExpression>
                            </datasetParameter>
                            <datasetParameter name="limit_used">
                                <datasetParameterExpression><![CDATA[$P{limit_used}]]></datasetParameterExpression>
                            </datasetParameter>
                        </datasetRun>
                    </dataset>
                    <categorySeries>
                        <seriesExpression><![CDATA["Wykorzystane godziny"]]></seriesExpression>
                        <categoryExpression><![CDATA[new String($F{project_name} + " - " + $F{task_name})]]></categoryExpression>
                        <valueExpression>
                            <![CDATA[new Double($F{reportedhrssum}.doubleValue() / ($F{orderlimit} > 0 ? $F{orderlimit} : ($F{tasklimit}.doubleValue() + $F{taskreserve}.doubleValue())))]]></valueExpression>
                        <labelExpression><![CDATA[$F{reportedhrssum}.toString()]]></labelExpression>
                        <itemHyperlink hyperlinkType="Reference" hyperlinkTarget="Blank">
                            <hyperlinkReferenceExpression><![CDATA["http://www.google.com"]]></hyperlinkReferenceExpression>
                            <hyperlinkTooltipExpression>
                                <![CDATA[new String($F{task_name} + " - " + $F{reportedhrssum}.toString())]]></hyperlinkTooltipExpression>
                        </itemHyperlink>
                    </categorySeries>
                    <categorySeries>
                        <seriesExpression><![CDATA["Pozostały limit"]]></seriesExpression>
                        <categoryExpression><![CDATA[new String($F{project_name} + " - " + $F{task_name})]]></categoryExpression>
                        <valueExpression>
                            <![CDATA[new Double($F{limitleft}.doubleValue() / ($F{orderlimit} > 0 ? $F{orderlimit} : ($F{tasklimit}.doubleValue() + $F{taskreserve}.doubleValue())))]]></valueExpression>
                        <labelExpression><![CDATA[$F{limitleft}.toString()]]></labelExpression>
                        <itemHyperlink hyperlinkType="Reference" hyperlinkTarget="Blank">
                            <hyperlinkTooltipExpression><![CDATA[$F{task_name} + " - " + $F{limitleft}.toString()]]></hyperlinkTooltipExpression>
                        </itemHyperlink>
                    </categorySeries>
                    <categorySeries>
                        <seriesExpression><![CDATA["Pozostała rezerwa"]]></seriesExpression>
                        <categoryExpression><![CDATA[new String($F{project_name} + " - " + $F{task_name})]]></categoryExpression>
                        <valueExpression>
                            <![CDATA[new Double($F{reserveleft}.doubleValue() / ($F{orderlimit} > 0 ? $F{orderlimit} : ($F{tasklimit}.doubleValue() + $F{taskreserve}.doubleValue())))]]></valueExpression>
                        <labelExpression><![CDATA[$F{reserveleft}.toString()]]></labelExpression>
                        <itemHyperlink hyperlinkType="Reference" hyperlinkTarget="Blank">
                            <hyperlinkTooltipExpression><![CDATA[$F{task_name} + " - " + $F{reserveleft}.toString()]]></hyperlinkTooltipExpression>
                        </itemHyperlink>
                    </categorySeries>
                </categoryDataset>
                <bar3DPlot isShowLabels="true">
                    <plot labelRotation="90.0"/>
                    <itemLabel color="#000000" backgroundColor="#FFFFFF">
                        <font fontName="SansSerif" size="8" pdfEncoding="Cp1250"/>
                    </itemLabel>
                    <categoryAxisFormat labelRotation="90.0">
                        <axisFormat verticalTickLabels="true">
                            <labelFont>
                                <font fontName="Verdana" size="8" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false"
                                      pdfFontName="Helvetica" pdfEncoding="Cp1250" isPdfEmbedded="false"/>
                            </labelFont>
                            <tickLabelFont>
                                <font fontName="Verdana" size="8" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false"
                                      pdfFontName="Helvetica" pdfEncoding="Cp1250" isPdfEmbedded="false"/>
                            </tickLabelFont>
                        </axisFormat>
                    </categoryAxisFormat>
                    <valueAxisFormat>
                        <axisFormat tickLabelMask="#%">
                            <labelFont>
                                <font size="10" pdfEncoding="Cp1250"/>
                            </labelFont>
                            <tickLabelFont>
                                <font size="10" pdfEncoding="Cp1250"/>
                            </tickLabelFont>
                        </axisFormat>
                    </valueAxisFormat>
                </bar3DPlot>
            </stackedBar3DChart>
            <frame>
                <reportElement mode="Opaque" x="0" y="378" width="383" height="41" backcolor="#FFFFFF"/>
                <staticText>
                    <reportElement x="0" y="0" width="187" height="20">
                        <printWhenExpression>
                            <![CDATA[$P{options}.contains("chart") && $V{ProjectGroup_COUNT} > 0 && $P{options}.contains("details")]]></printWhenExpression>
                    </reportElement>
                    <textElement>
                        <font size="12" pdfEncoding="Cp1250"/>
                    </textElement>
                    <text><![CDATA[Szczegółowe wykresy zadań:]]></text>
                </staticText>
                <componentElement>
                    <reportElement x="0" y="20" width="332" height="16">
                        <printWhenExpression>
                            <![CDATA[$P{options}.contains("chart") && $V{ProjectGroup_COUNT} > 0 && $P{options}.contains("details")]]></printWhenExpression>
                    </reportElement>
                    <jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components"
                             xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd"
                             printOrder="Vertical">
                        <datasetRun subDataset="chart_dataset">
                            <datasetParameter name="login">
                                <datasetParameterExpression><![CDATA[$P{login}]]></datasetParameterExpression>
                            </datasetParameter>
                            <datasetParameter name="projects">
                                <datasetParameterExpression><![CDATA[$P{projects}]]></datasetParameterExpression>
                            </datasetParameter>
                            <datasetParameter name="limit_used">
                                <datasetParameterExpression><![CDATA[$P{limit_used}]]></datasetParameterExpression>
                            </datasetParameter>
                        </datasetRun>
                        <jr:listContents height="16" width="332">
                            <textField hyperlinkType="Reference">
                                <reportElement x="0" y="0" width="332" height="15"/>
                                <textElement/>
                                <textFieldExpression class="java.lang.String"><![CDATA["- " + $F{project_name} + "-" + $F{task_name}]]></textFieldExpression>
                                <hyperlinkReferenceExpression>
                                    <![CDATA["drilldown?reportName=RaportZuzyciaLimitowZadanSzczegoly&allowRefresh=true&allowedFormats=PDF&task_id=" + $F{task_id} + "&login=" + $P{login}]]></hyperlinkReferenceExpression>
                            </textField>
                        </jr:listContents>
                    </jr:list>
                </componentElement>
            </frame>
            <componentElement>
                <reportElement x="121" y="433" width="262" height="26">
                    <printWhenExpression><![CDATA[$P{options}.contains("projects")]]></printWhenExpression>
                </reportElement>
                <jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components"
                         xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd"
                         printOrder="Vertical">
                    <datasetRun subDataset="projects_dataset">
                        <datasetParameter name="projects">
                            <datasetParameterExpression><![CDATA[$P{projects}]]></datasetParameterExpression>
                        </datasetParameter>
                        <datasetParameter name="login">
                            <datasetParameterExpression><![CDATA[$P{login}]]></datasetParameterExpression>
                        </datasetParameter>
                    </datasetRun>
                    <jr:listContents height="26" width="262">
                        <textField>
                            <reportElement style="SubTitle" x="0" y="0" width="159" height="26"/>
                            <textElement textAlignment="Left" verticalAlignment="Middle"/>
                            <textFieldExpression class="java.lang.String"><![CDATA[$F{name}]]></textFieldExpression>
                        </textField>
                        <textField>
                            <reportElement style="SubTitle" x="159" y="0" width="103" height="26"/>
                            <textElement textAlignment="Left" verticalAlignment="Middle"/>
                            <textFieldExpression class="java.lang.String"><![CDATA[$F{level}]]></textFieldExpression>
                        </textField>
                    </jr:listContents>
                </jr:list>
            </componentElement>
            <staticText>
                <reportElement style="SubTitle" x="0" y="433" width="121" height="26">
                    <printWhenExpression><![CDATA[$P{options}.contains("projects")]]></printWhenExpression>
                </reportElement>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[Projekty:]]></text>
            </staticText>
        </band>
    </summary>
</jasperReport>
